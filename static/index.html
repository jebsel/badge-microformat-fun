<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="google-code-prettify/prettify.css">
<title>Badge Microformat Fun</title>
<div class="container">
<h1>Badge Microformat Fun</h1>

<form id="build">
  <fieldset>
    <legend>Build a Badge</legend>

    <div class="row">
      <div class="span4">
        <label>Badge Name</label>
        <input class="input-xlarge" type="text" name="name" required>

        <label>Badge Image URL</label>
        <input class="input-xlarge" type="text" name="image" placeholder="http://" required>

        <label>Short Badge Description</label>
        <input class="input-xlarge" type="text" name="description" required>
      </div>
      <div class="span4">
        <label>Recipient Name</label>
        <input class="input-xlarge" type="text" name="recipient-name" required>

        <label>Recipient Email</label>
        <input class="input-xlarge" type="text" name="recipient" required>

        <label class="checkbox">
          <input type="checkbox" name="hash"> Hash Recipient Email
        </label>
        <span class="help-block">Hashing the recipient's email address prevents it from being publicly known, while still allowing the badge's issuance to be verified.</span>
      </div>
      <div class="span4">
        <label>Issuance Date</label>
        <input class="input-small" type="text" name="issuance">

        <label>Issuer Name</label>
        <input class="input-xlarge" type="text" name="issuer-name" required>

        <label>Issuer URL</label>
        <input class="input-xlarge" type="text" name="issuer" placeholder="http://" required>
        <span class="help-block">Note that the badge HTML <em>must</em> be hosted at the issuer's domain, or it will be invalid.</span>
      </div>
  </fieldset>
</form>

<p>Below is your badge's HTML.</p>

<pre id="badge-html"></pre>

<form action="/assertion">
  <fieldset>
    <legend>Validate a Badge</legend>

    <label>URL</label>
    <input class="input-xlarge" type="text" name="url">

    <label>Test HTML (optional)</label>
    <textarea class="input-block-level" rows="20" name="testHtml"></textarea>

    <div class="form-actions">
      <input class="btn btn-primary" type="submit" value="Validate">
    </div>
  </fieldset>
</form>

<div id="badge-template" style="display: none"><div class="h-badge">
  <h3 class="p-name"></h3>
  <img class="u-image">
  <p class="p-description"></p>
  <p>
    This badge is awarded to
    <a class="p-recipient h-card"></a>
    on
    <time class="dt-issuance"></time>
    by
    <a class="u-issuer p-issuer-name"></a>,
    in recognition of their awesomeness.
  </p>
</div></div>
</div>

<script src="sha256.js"></script>
<script src="moment.min.js"></script>
<script src="google-code-prettify/prettify.js"></script>
<script>
var SALT = "deadsea";

var today = moment().format("YYYY-MM-DD");
var buildForm = $("#build");
var badge = $("#badge-template .h-badge");

function $(selector, element) {
  return (element || document).querySelector(selector);
}

function generateBadge() {
  var recipientUrl;
  var issueDate = moment($("[name=issuance]").value.trim() || today,
                         "YYYY-MM-DD");

  $(".p-name", badge).textContent = $("[name=name]").value;
  $(".u-image", badge).setAttribute("src", $("[name=image]").value);
  $(".p-description", badge).textContent = $("[name=description]").value;
  $(".p-recipient", badge).textContent = $("[name=recipient-name]").value;

  if ($("[name=hash]").checked)
    recipientUrl = "hmailto:" +
                   Sha256.hash($("[name=recipient]").value + SALT) +
                   "?hashfunc=sha256&salt=" +
                   encodeURIComponent(SALT);
  else
    recipientUrl = "mailto:" + $("[name=recipient]").value;

  $(".p-recipient", badge).setAttribute("href", recipientUrl);

  $(".dt-issuance", badge).textContent = issueDate
                                         ? issueDate.format("MMMM Do YYYY")
                                         : "";
  $(".dt-issuance", badge).setAttribute("datetime",
                                        issueDate
                                        ? issueDate.format("YYYY-MM-DD")
                                        : "");

  $(".u-issuer", badge).setAttribute("href", $("[name=issuer]").value);
  $(".p-issuer-name", badge).textContent = $("[name=issuer-name]").value;

  $("#badge-html").textContent = $("#badge-template").innerHTML;
  $("#badge-html").innerHTML = prettyPrintOne($("#badge-html").innerHTML,
                                                'html');
}

$("[name=issuance]").setAttribute("placeholder", today);

buildForm.addEventListener("keyup", generateBadge, false);
buildForm.addEventListener("change", generateBadge, false);

onload = generateBadge;
</script>
